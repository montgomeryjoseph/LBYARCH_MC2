#include <stdio.h>
#include <stdlib.h>
#include <math.h>
#include <immintrin.h>

void calculate_distance(int n, double *x1, double *x2, double *y1, double *y2, double *z){
	for (int i = 0; i < n; i++){
		__m128d diffX = _mm_set_sd(x2[i] - x1[i]);
		__m128d diffY = _mm_set_sd(y2[i] - y1[i]);

		diffX = _mm_mul_sd(diffX, diffX);
		diffY = _mm_mul_sd(diffY, diffY);

		__m128d summation = _mm_add_sd(diffX, diffY);
		__m128d finalResult = _mm_sqrt_sd(summation, summation);

		_mm_store_sd(&z[i], finalResult);
	}
}

extern void calculateDist(int n, double *x1, double *x2, double *y1, double *y2, double *z);

int main(){
	int n = 30;
	double x1[] = {-29.54055965, -13.85666227, 40.17597939, -5.52994617, -18.77637972, 
                -22.30331876, -61.93569366, -31.47123487, -54.52802323, 19.71896752,
                -4.14341211, 18.40264913, 81.82228907, 74.83453338, 44.07098047,
                -50.06251205, 36.01939416, 68.94705449, 87.63035529, -24.77754759, 
                34.58056204, -61.10872894, 7.99803805, -82.70704863, 68.68026709, 
                90.60913751, 40.51112838, -62.27282653, 98.03746944, 12.72900807};
    double x2[] = {-19.60404362, 5.76976915, 36.63465145, -88.89199892, 1.32793070, 
                28.49822647, 7.80294739, -92.51051779, -86.93533030, 40.43400472, 
                95.53858061, 10.73672372, 57.82817820, 56.29907098, 74.83156374, 
                91.75636292, 64.44877132, -88.25239459, 31.07011371, 1.17314225, 
                47.61228571, 15.82542830, 67.46100917, 13.66601406, 64.17418073, 
                31.43872378, -50.32425558, 71.75972839, 79.97117247, 59.83024186};
    double y1[] = {-69.32139756, 71.10760040, -24.28809327, 96.44594435, -46.69885865, 
                54.39541907, -11.01191960, 75.31203642, -83.88502520, 88.17552273, 
                -77.38469317, 3.21757086, 98.47156371, 79.70988998, 51.78596598, 
                -46.18801792, 8.06344273, 87.61253209, -12.69529732, 51.96272170, 
                -33.50386900, -6.44598958, 53.26961490, 92.22384952, -82.71938577, 
                -10.43454714, -61.87759165, 46.22410607, -5.89702162, -35.91642307};
    double y2[] = {71.55578301, 86.51567790, 53.97715573, -37.92110751, -16.06508084, 
                -46.24269010, 23.10982846, 22.91748244, 25.59789019, 47.65048570, 
                40.47539704, 73.97874634, 87.89414982, -67.10109880, 6.50790412, 
                34.79691318, 54.89546243, -76.79671821, 8.37667663, 76.75125432, 
                52.74789674, -30.97834772, -60.38199150, 74.25506669, 60.08914167, 
                70.91830233, 72.53140194, 15.20414430, -81.24312152, -30.40967236};
    double *z = (double*)malloc(n*sizeof(double));

    //calculate_distance(n, x1,x2,y1,y2,z);

    //int i;
    //for(i = 0; i < n; i++){
    //	printf("%f\n", z[i]);
    //}

    //free(z);

    calculateDist(n,x1,x2,y1,y2,z);

    //printf("\n");

    for(int i = 0; i < n; i++){
    	printf("Z[%d] = %.8f\n", i, z[i]);
    }

    free(z);
	return 0;
}